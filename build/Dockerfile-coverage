ARG DOCKER_BASE_IMAGE

FROM $DOCKER_BASE_IMAGE

ARG REMOTE_SOURCE
ARG REMOTE_SOURCE_DIR
ARG GITHUB_TOKEN

ENV OPERATOR=/usr/local/bin/clusterlifecycle-state-metrics \
    USER_UID=1001 \
    USER_NAME=clusterlifecycle-state-metrics
    
USER root
# Install unzip
RUN microdnf update
RUN microdnf install -y --nodocs jq
RUN microdnf install -y --nodocs openssl

# install operator binary
RUN cp ${OPERATOR}-coverage ${OPERATOR}

USER ${USER_UID}

ENTRYPOINT ["/usr/local/bin/entrypoint-coverage"]

ARG VCS_REF
ARG VCS_URL
ARG IMAGE_NAME
ARG IMAGE_DESCRIPTION
ARG ARCH_TYPE
ARG REMOTE_SOURCE_DIR

LABEL com.redhat.component="clusterlifecycle-state-metrics-container" \
      name="rhacm1-tech-preview/clusterlifecycle-state-metrics-rhel8" \
      version="${CI_CONTAINER_VERSION}" \
      release="${CI_CONTAINER_RELEASE}" \
      summary="clusterlifecycle-state-metrics" \
      io.openshift.expose-services="" \
      io.openshift.tags="data,images" \
      io.k8s.display-name="clusterlifecycle-state-metrics" \
      maintainer="['eisraeli@redhat.com', 'jbieren@redhat.com']" \
      description="clusterlifecycle-state-metrics"